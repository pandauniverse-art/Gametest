<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Game 3: Time Attack</title>
    <style>
        body { margin: 0; background: radial-gradient(circle at center, #1a1a2e 0%, #000000 100%); font-family: 'Pretendard', sans-serif; color: white; user-select: none; touch-action: manipulation; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; }
        .ui-screen { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.9); z-index: 100; }
        .hidden { display: none !important; }
        .glass-panel { background: rgba(20, 20, 30, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.15); border-radius: 20px; padding: 40px; text-align: center; }
        
        button { padding: 15px 50px; font-size: 24px; font-weight: bold; border: none; border-radius: 50px; cursor: pointer; background: linear-gradient(135deg, #00ff88, #00b8d4); color: #000; margin-top: 20px; }
        
        #hud { position: absolute; top: 20px; display: flex; gap: 40px; font-size: 24px; font-weight: bold; color: #00ff88; z-index: 10; }
        .warning { color: #ff2a6d !important; animation: blink 0.5s infinite; }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.5; } }

        #grid-container { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; perspective: 1000px; padding: 20px; }
        .card { width: 80px; height: 80px; position: relative; transform-style: preserve-3d; transition: transform 0.5s; cursor: pointer; }
        .card.flipped { transform: rotateY(180deg); }
        .card.matched { visibility: hidden; opacity: 0; transition: 0.5s; }
        .card-face { position: absolute; width: 100%; height: 100%; backface-visibility: hidden; display: flex; align-items: center; justify-content: center; border-radius: 15px; font-size: 40px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .card-front { background: #222; border: 2px solid #444; }
        .card-back { background: #111; transform: rotateY(180deg); border: 2px solid #00ff88; }
        
        #damage-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: red; opacity: 0; pointer-events: none; z-index: 90; transition: opacity 0.1s; }
        #back-btn { position: absolute; top: 20px; left: 20px; padding: 10px 20px; background: rgba(255,255,255,0.1); color: white; border: 1px solid rgba(255,255,255,0.2); text-decoration: none; border-radius: 10px; z-index: 20; }
        
        @media (max-width: 500px) { .card { width: 18vmin; height: 18vmin; } }
    </style>
</head>
<body>
    <a href="index.html" id="back-btn">â¬… HOME</a>
    <div id="damage-overlay"></div>
    
    <div id="hud">
        <div>TIME: <span id="time-cnt">60</span>s</div>
        <div>SCORE: <span id="score-cnt">0</span></div>
    </div>

    <div id="grid-container"></div>

    <div id="start-screen" class="ui-screen">
        <div class="glass-panel">
            <h1>TIME ATTACK</h1>
            <p>Match: +3s / Wrong: -2s<br>Clear before time runs out!</p>
            <button onclick="startGame()">START</button>
        </div>
    </div>

    <div id="fail-screen" class="ui-screen hidden">
        <div class="glass-panel">
            <h1 style="color:red">TIME OVER</h1>
            <p>Final Score: <span id="final-score">0</span></p>
            <button onclick="startGame()">RETRY</button>
        </div>
    </div>

    <script>
        const assets = ['ðŸ’¾', 'ðŸ“', 'ðŸ–Œï¸', 'ðŸŽ¨', 'ðŸ–¥ï¸', 'ðŸ–±ï¸', 'ðŸ“·', 'ðŸŽ¬']; 
        let grid = []; let flipped = []; let matched = 0; let score = 0;
        let time = 60; let timerInterval; let isLocked = false;
        
        const gridEl = document.getElementById('grid-container');
        const timeEl = document.getElementById('time-cnt');
        const scoreEl = document.getElementById('score-cnt');
        const dmgOverlay = document.getElementById('damage-overlay');

        function startGame() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('fail-screen').classList.add('hidden');
            
            grid = [...assets, ...assets].sort(() => Math.random() - 0.5);
            gridEl.innerHTML = '';
            flipped = []; matched = 0; score = 0; time = 60; isLocked = false;
            
            scoreEl.innerText = score;
            timeEl.innerText = time;
            timeEl.classList.remove('warning');

            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                time--;
                timeEl.innerText = time;
                if(time <= 10) timeEl.classList.add('warning');
                if(time <= 0) gameOver();
            }, 1000);

            grid.forEach((icon, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.icon = icon;
                card.innerHTML = `<div class="card-face card-front"></div><div class="card-face card-back">${icon}</div>`;
                card.onclick = () => flipCard(card);
                gridEl.appendChild(card);
            });
        }

        function flipCard(card) {
            if (isLocked || card.classList.contains('flipped') || time <= 0) return;
            card.classList.add('flipped');
            flipped.push(card);
            if (flipped.length === 2) checkMatch();
        }

        function checkMatch() {
            isLocked = true;
            const [c1, c2] = flipped;
            
            if (c1.dataset.icon === c2.dataset.icon) {
                // ì •ë‹µ (+3ì´ˆ)
                time += 3; score += 100;
                timeEl.innerText = time; scoreEl.innerText = score;
                setTimeout(() => {
                    c1.classList.add('matched'); c2.classList.add('matched');
                    resetTurn();
                    matched++;
                    if(matched === assets.length) gameOver(true);
                }, 500);
            } else {
                // ì˜¤ë‹µ (-2ì´ˆ)
                time -= 2; 
                timeEl.innerText = time;
                // ë°ë¯¸ì§€ íš¨ê³¼
                dmgOverlay.style.opacity = 0.5; setTimeout(()=>dmgOverlay.style.opacity=0, 100);
                setTimeout(() => {
                    c1.classList.remove('flipped'); c2.classList.remove('flipped');
                    resetTurn();
                }, 800);
            }
        }

        function resetTurn() { flipped = []; isLocked = false; }

        function gameOver(clear = false) {
            clearInterval(timerInterval);
            document.getElementById('fail-screen').classList.remove('hidden');
            document.querySelector('#fail-screen h1').innerText = clear ? "CLEAR!" : "TIME OVER";
            document.querySelector('#fail-screen h1').style.color = clear ? "#00ff88" : "red";
            document.getElementById('final-score').innerText = score;
        }
    </script>
</body>
</html>
